<!doctype html>
<title>gf28 performance tests</title>
<script src="../closure-library/closure/goog/base.js"></script>
<script src="deps.js"></script>
<script>
  goog.require('gf28');
  goog.require('goog.testing.PerformanceTable');
  goog.require('goog.testing.PseudoRandom');
  goog.require('goog.testing.jsunit');
</script>
<div id="p"></div>
<script>

// generate lookup tables
gf28.mul(1, 1);

var table = new goog.testing.PerformanceTable(goog.dom.getElement('p'));

var NUM_MULTIPLIES = 10000000;

var NUM_POWS = 1000000;

var NUM_ADDS = 10000000;

var inputs, outputs;

(function() {
  var nInputs = Math.max(NUM_MULTIPLIES, NUM_POWS, NUM_ADDS);
  inputs = new Uint8Array(nInputs * 2);
  outputs = new Uint8Array(nInputs);
  var randomMock = new goog.testing.PseudoRandom(0, true);
  for (var i = 0; i < nInputs; ++i) {
    inputs[i] = Math.floor(Math.random() * 256);
    inputs[nInputs + i] = Math.floor(Math.random() * 256);
  }
  randomMock.uninstall();
})();

function testMultiply() {
  table.run(function() {
    for (var i = 0; i < NUM_MULTIPLIES; ++i) {
      outputs[i] = gf28.mul(inputs[i], inputs[NUM_MULTIPLIES + i]);
    }
  }, NUM_MULTIPLIES + ' multiplications');
}

function testPow() {
  table.run(function() {
    for (var i = 0; i < NUM_POWS; ++i) {
      outputs[i] = gf28.pow(inputs[i], inputs[NUM_POWS + i]);
    }
  }, NUM_POWS + ' exponentiations');
}

function testAdd() {
  table.run(function() {
    for (var i = 0; i < NUM_ADDS; ++i) {
      outputs[i] = gf28.add(inputs[i], inputs[NUM_ADDS + i]);
    }
  }, NUM_ADDS + ' adds');
}
</script>
